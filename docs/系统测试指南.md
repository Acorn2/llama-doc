# ğŸ§ª æ™ºèƒ½æ–‡æ¡£åˆ†æå¹³å° - ç³»ç»Ÿæµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ

æœ¬æ–‡æ¡£æä¾›äº†æ™ºèƒ½æ–‡æ¡£åˆ†æå¹³å°çš„å®Œæ•´æµ‹è¯•æŒ‡å—ï¼ŒåŒ…æ‹¬æµ‹è¯•è´¦å·ã€æœåŠ¡é…ç½®ã€APIæµ‹è¯•ã€åŠŸèƒ½éªŒè¯ç­‰å†…å®¹ã€‚

---

## ğŸ” æµ‹è¯•è´¦å·ä¿¡æ¯

### å·²æ³¨å†Œæµ‹è¯•ç”¨æˆ·

| ç”¨æˆ·ID | ç”¨æˆ·å | é‚®ç®± | å¯†ç  | æƒé™ | çŠ¶æ€ |
|--------|--------|------|------|------|------|
| `fe005d74-cb6d-4fbd-96ba-2648d62a9db8` | hresh | hkyy521@163.com | 123456 | æ™®é€šç”¨æˆ· | æ¿€æ´» |
| `dea0e8eb-4efb-4c67-8a69-87165a8daccc` | hak | hresh@163.com | 123456 | æ™®é€šç”¨æˆ· | æ¿€æ´» |

### ç™»å½•è¯´æ˜
âš ï¸ **é‡è¦æé†’**: ç³»ç»Ÿåªæ”¯æŒ**é‚®ç®±ç™»å½•**ï¼Œä¸æ”¯æŒç”¨æˆ·åç™»å½•ï¼

**æ­£ç¡®çš„ç™»å½•æ–¹å¼**:
```json
{
  "login_credential": "hkyy521@163.com",
  "password": "123456"
}
```

**é”™è¯¯çš„ç™»å½•æ–¹å¼**:
```json
{
  "login_credential": "hresh",  // âŒ ä¸æ”¯æŒç”¨æˆ·å
  "password": "123456"
}
```

---

## ğŸŒ æœåŠ¡åœ°å€é…ç½®

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

| æœåŠ¡ | åœ°å€ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| **APIæœåŠ¡** | http://localhost:8000 | âœ… è¿è¡Œä¸­ | ä¸»è¦åç«¯æœåŠ¡ |
| **APIæ–‡æ¡£** | http://localhost:8000/docs | âœ… å¯è®¿é—® | Swagger UI |
| **å¥åº·æ£€æŸ¥** | http://localhost:8000/health | âœ… æ­£å¸¸ | ç³»ç»ŸçŠ¶æ€ |
| **Qdrant** | http://101.35.134.101:6333 | âœ… è¿è¡Œä¸­ | å‘é‡æ•°æ®åº“ |
| **Qdrantç®¡ç†ç•Œé¢** | http://101.35.134.101:6333/dashboard| âœ… å¯è®¿é—® | å‘é‡åº“ç®¡ç† |

### Qdrant å¯åŠ¨å‘½ä»¤
```bash
# Dockeræ–¹å¼å¯åŠ¨Qdrant
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant:v1.7.1

# æˆ–ä½¿ç”¨docker-compose
docker-compose up qdrant
```

---

## ğŸ”§ ç¯å¢ƒé…ç½®æ£€æŸ¥

### å¿…éœ€ç¯å¢ƒå˜é‡

| å˜é‡å | å½“å‰çŠ¶æ€ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|----------|------|--------|
| `QDRANT_HOST` | âŒ æœªè®¾ç½® | QdrantæœåŠ¡å™¨åœ°å€ | localhost |
| `QDRANT_PORT` | âŒ æœªè®¾ç½® | Qdrantç«¯å£ | 6333 |
| `DATABASE_URL` | âŒ æœªè®¾ç½® | æ•°æ®åº“è¿æ¥ | postgresql://user:pass@localhost:5432/db |
| `DASHSCOPE_API_KEY` | âŒ æœªè®¾ç½® | é€šä¹‰åƒé—®APIå¯†é’¥ | sk-xxx |
| `OPENAI_API_KEY` | âŒ æœªè®¾ç½® | OpenAI APIå¯†é’¥ | sk-xxx |
| `SECRET_KEY` | âŒ æœªè®¾ç½® | JWTå¯†é’¥ | your-secret-key |

### é…ç½®æ–‡ä»¶ä½ç½®
- å¼€å‘ç¯å¢ƒ: `.env.development`
- ç”Ÿäº§ç¯å¢ƒ: `.env.production`
- ç¤ºä¾‹é…ç½®: `.env.development.example`

---

## ğŸ§ª APIæ¥å£æµ‹è¯•

### 1. å¥åº·æ£€æŸ¥æµ‹è¯•

```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# è¯¦ç»†å¥åº·æ£€æŸ¥
curl http://localhost:8000/api/v1/system/health
```

**é¢„æœŸå“åº”**:
```json
{
  "status": "healthy",
  "timestamp": "2025-10-23T14:46:00.000Z",
  "version": "1.0.0"
}
```

### 2. ç”¨æˆ·è®¤è¯æµ‹è¯•

#### ç”¨æˆ·ç™»å½•
```bash
curl -X POST "http://localhost:8000/api/v1/users/login" \
  -H "Content-Type: application/json" \
  -d '{
    "login_credential": "hkyy521@163.com",
    "password": "123456"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 604800,
  "user": {
    "id": "fe005d74-cb6d-4fbd-96ba-2648d62a9db8",
    "username": "hresh",
    "email": "hkyy521@163.com",
    "is_active": true
  }
}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯
```bash
# ä½¿ç”¨ä¸Šé¢è·å–çš„token
curl -X GET "http://localhost:8000/api/v1/users/me" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### 3. æ–‡æ¡£ç®¡ç†æµ‹è¯•

#### ä¸Šä¼ æ–‡æ¡£
```bash
curl -X POST "http://localhost:8000/api/v1/documents/upload" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -F "file=@test_document.pdf"
```

#### è·å–æ–‡æ¡£åˆ—è¡¨
```bash
curl -X GET "http://localhost:8000/api/v1/documents" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### 4. çŸ¥è¯†åº“æµ‹è¯•

#### åˆ›å»ºçŸ¥è¯†åº“
```bash
curl -X POST "http://localhost:8000/api/v1/knowledge-bases/" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æµ‹è¯•çŸ¥è¯†åº“",
    "description": "ç”¨äºæµ‹è¯•çš„çŸ¥è¯†åº“",
    "is_public": false,
    "tags": ["æµ‹è¯•", "demo"]
  }'
```

#### è·å–å…¬å¼€çŸ¥è¯†åº“
```bash
curl -X GET "http://localhost:8000/api/v1/knowledge-bases/public"
```

### 5. Agentå¯¹è¯æµ‹è¯•

#### æ™ºèƒ½å¯¹è¯
```bash
curl -X POST "http://localhost:8000/api/v1/agent/chat" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "kb_id": "YOUR_KB_ID",
    "message": "è¯·ä»‹ç»ä¸€ä¸‹è¿™ä¸ªçŸ¥è¯†åº“çš„å†…å®¹",
    "use_agent": true,
    "llm_type": "qwen"
  }'
```

---

## ğŸ” åŠŸèƒ½æµ‹è¯•æ¸…å•

### âœ… ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- [ ] ç”¨æˆ·æ³¨å†Œ
- [x] ç”¨æˆ·ç™»å½•ï¼ˆé‚®ç®±ï¼‰
- [ ] ç”¨æˆ·ç™»å½•ï¼ˆæ‰‹æœºå·ï¼‰
- [x] è·å–ç”¨æˆ·ä¿¡æ¯
- [ ] æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- [ ] ç”¨æˆ·æƒé™éªŒè¯

### âœ… æ–‡æ¡£ç®¡ç†åŠŸèƒ½
- [ ] æ–‡æ¡£ä¸Šä¼ ï¼ˆPDFï¼‰
- [ ] æ–‡æ¡£ä¸Šä¼ ï¼ˆTXTï¼‰
- [ ] æ–‡æ¡£ä¸Šä¼ ï¼ˆDOCXï¼‰
- [ ] æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢
- [ ] æ–‡æ¡£è¯¦æƒ…æŸ¥çœ‹
- [ ] æ–‡æ¡£åˆ é™¤
- [ ] é‡å¤æ–‡æ¡£æ£€æµ‹

### âœ… çŸ¥è¯†åº“åŠŸèƒ½
- [ ] åˆ›å»ºç§æœ‰çŸ¥è¯†åº“
- [ ] åˆ›å»ºå…¬å¼€çŸ¥è¯†åº“
- [ ] çŸ¥è¯†åº“åˆ—è¡¨æŸ¥è¯¢
- [ ] çŸ¥è¯†åº“æœç´¢
- [ ] çŸ¥è¯†åº“ç‚¹èµ
- [ ] æ–‡æ¡£å…³è”ç®¡ç†

### âœ… æ™ºèƒ½å¯¹è¯åŠŸèƒ½
- [ ] æ™®é€šå¯¹è¯æ¨¡å¼
- [ ] Agentæ™ºèƒ½æ¨¡å¼
- [ ] æµå¼å¯¹è¯
- [ ] å¯¹è¯å†å²
- [ ] ä¸Šä¸‹æ–‡è®°å¿†

### âœ… ç³»ç»ŸåŠŸèƒ½
- [x] å¥åº·æ£€æŸ¥
- [ ] ç³»ç»Ÿç›‘æ§
- [ ] æ—¥å¿—è®°å½•
- [ ] é”™è¯¯å¤„ç†
- [ ] æ€§èƒ½ç›‘æ§

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. ç™»å½•å¤±è´¥é—®é¢˜

**é—®é¢˜**: æç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ä½¿ç”¨é‚®ç®±è€Œéç”¨æˆ·åç™»å½•
2. æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ç”¨æˆ·è´¦å·æ˜¯å¦æ¿€æ´»

### 2. Qdrantè¿æ¥é—®é¢˜

**é—®é¢˜**: å‘é‡æœç´¢åŠŸèƒ½ä¸å¯ç”¨
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥QdrantçŠ¶æ€
curl http://localhost:6333/health

# å¯åŠ¨Qdrant
docker run -p 6333:6333 qdrant/qdrant:v1.7.1
```

### 3. æ–‡æ¡£ä¸Šä¼ å¤±è´¥

**é—®é¢˜**: æ–‡æ¡£ä¸Šä¼ è¿”å›é”™è¯¯
**æ£€æŸ¥é¡¹**:
1. æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒï¼ˆPDFã€TXTã€DOCXã€MDï¼‰
2. æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™ï¼ˆé»˜è®¤50MBï¼‰
3. ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
4. å­˜å‚¨ç›®å½•æƒé™æ˜¯å¦æ­£ç¡®

### 4. APIè°ƒç”¨403é”™è¯¯

**é—®é¢˜**: æ¥å£è¿”å›æƒé™ä¸è¶³
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥Tokenæ˜¯å¦æœ‰æ•ˆ
2. ç¡®è®¤ç”¨æˆ·æƒé™çº§åˆ«
3. éªŒè¯è¯·æ±‚å¤´æ ¼å¼: `Authorization: Bearer TOKEN`

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å“åº”æ—¶é—´åŸºå‡†

| æ¥å£ç±»å‹ | é¢„æœŸå“åº”æ—¶é—´ | è¯´æ˜ |
|----------|--------------|------|
| ç”¨æˆ·ç™»å½• | < 500ms | åŒ…å«æ•°æ®åº“æŸ¥è¯¢å’ŒJWTç”Ÿæˆ |
| æ–‡æ¡£ä¸Šä¼  | < 5s | å–å†³äºæ–‡ä»¶å¤§å° |
| çŸ¥è¯†åº“æŸ¥è¯¢ | < 200ms | ç®€å•æŸ¥è¯¢ |
| Agentå¯¹è¯ | < 10s | å–å†³äºLLMå“åº”é€Ÿåº¦ |
| å‘é‡æœç´¢ | < 1s | éœ€è¦Qdrantæ­£å¸¸è¿è¡Œ |

### å¹¶å‘æµ‹è¯•

```bash
# ä½¿ç”¨abè¿›è¡Œç®€å•å¹¶å‘æµ‹è¯•
ab -n 100 -c 10 http://localhost:8000/health

# ä½¿ç”¨wrkè¿›è¡Œè´Ÿè½½æµ‹è¯•
wrk -t12 -c400 -d30s http://localhost:8000/health
```

---

## ğŸ”§ å¼€å‘è°ƒè¯•å·¥å…·

### 1. å†…ç½®æµ‹è¯•æ¥å£

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
curl http://localhost:8000/api/v1/test/database

# æµ‹è¯•è®¤è¯æµç¨‹
curl http://localhost:8000/api/v1/users/test-auth

# æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£
curl -H "Authorization: Bearer TOKEN" \
     http://localhost:8000/api/v1/users/test-auth-required
```

### 2. æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/app.log | tail -20

# æŸ¥çœ‹ç”¨æˆ·æ´»åŠ¨æ—¥å¿—
grep "ç”¨æˆ·æ´»åŠ¨" logs/app.log
```

### 3. æ•°æ®åº“æŸ¥è¯¢

```sql
-- æŸ¥çœ‹ç”¨æˆ·è¡¨
SELECT id, username, email, is_active, create_time FROM users;

-- æŸ¥çœ‹çŸ¥è¯†åº“è¡¨
SELECT id, name, is_public, user_id, create_time FROM knowledge_bases;

-- æŸ¥çœ‹æ–‡æ¡£è¡¨
SELECT id, filename, status, user_id, create_time FROM documents;
```

---

## ğŸ“ æµ‹è¯•è„šæœ¬

### Pythonæµ‹è¯•è„šæœ¬

```python
#!/usr/bin/env python3
"""
ç³»ç»ŸåŠŸèƒ½æµ‹è¯•è„šæœ¬
"""
import requests
import json

BASE_URL = "http://localhost:8000"

def test_login():
    """æµ‹è¯•ç”¨æˆ·ç™»å½•"""
    response = requests.post(f"{BASE_URL}/api/v1/users/login", json={
        "login_credential": "hkyy521@163.com",
        "password": "123456"
    })
    
    if response.status_code == 200:
        print("âœ… ç™»å½•æµ‹è¯•é€šè¿‡")
        return response.json()["access_token"]
    else:
        print(f"âŒ ç™»å½•æµ‹è¯•å¤±è´¥: {response.text}")
        return None

def test_user_info(token):
    """æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯"""
    headers = {"Authorization": f"Bearer {token}"}
    response = requests.get(f"{BASE_URL}/api/v1/users/me", headers=headers)
    
    if response.status_code == 200:
        print("âœ… ç”¨æˆ·ä¿¡æ¯è·å–æµ‹è¯•é€šè¿‡")
        return True
    else:
        print(f"âŒ ç”¨æˆ·ä¿¡æ¯è·å–æµ‹è¯•å¤±è´¥: {response.text}")
        return False

def main():
    print("ğŸ§ª å¼€å§‹ç³»ç»ŸåŠŸèƒ½æµ‹è¯•")
    
    # æµ‹è¯•ç™»å½•
    token = test_login()
    if not token:
        return
    
    # æµ‹è¯•ç”¨æˆ·ä¿¡æ¯
    test_user_info(token)
    
    print("ğŸ‰ æµ‹è¯•å®Œæˆ")

if __name__ == "__main__":
    main()
```

### Bashæµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# ç³»ç»Ÿå¿«é€Ÿæµ‹è¯•è„šæœ¬

echo "ğŸ§ª å¼€å§‹ç³»ç»Ÿå¿«é€Ÿæµ‹è¯•"

# æµ‹è¯•å¥åº·æ£€æŸ¥
echo "1. æµ‹è¯•å¥åº·æ£€æŸ¥..."
curl -s http://localhost:8000/health | grep -q "healthy" && echo "âœ… å¥åº·æ£€æŸ¥é€šè¿‡" || echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥"

# æµ‹è¯•ç™»å½•
echo "2. æµ‹è¯•ç”¨æˆ·ç™»å½•..."
TOKEN=$(curl -s -X POST "http://localhost:8000/api/v1/users/login" \
  -H "Content-Type: application/json" \
  -d '{"login_credential": "hkyy521@163.com", "password": "123456"}' | \
  python3 -c "import sys, json; print(json.load(sys.stdin)['access_token'])" 2>/dev/null)

if [ ! -z "$TOKEN" ]; then
    echo "âœ… ç™»å½•æµ‹è¯•é€šè¿‡"
    
    # æµ‹è¯•ç”¨æˆ·ä¿¡æ¯
    echo "3. æµ‹è¯•ç”¨æˆ·ä¿¡æ¯è·å–..."
    curl -s -H "Authorization: Bearer $TOKEN" \
         http://localhost:8000/api/v1/users/me | \
         grep -q "email" && echo "âœ… ç”¨æˆ·ä¿¡æ¯è·å–é€šè¿‡" || echo "âŒ ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥"
else
    echo "âŒ ç™»å½•æµ‹è¯•å¤±è´¥"
fi

echo "ğŸ‰ å¿«é€Ÿæµ‹è¯•å®Œæˆ"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [APIæ¥å£æ–‡æ¡£-å®Œæ•´ç‰ˆ.md](./APIæ¥å£æ–‡æ¡£-å®Œæ•´ç‰ˆ.md) - å®Œæ•´çš„APIæ¥å£è¯´æ˜
- [åç«¯æœåŠ¡åŠŸèƒ½æ¢³ç†-æœ€æ–°ç‰ˆ.md](./åç«¯æœåŠ¡åŠŸèƒ½æ¢³ç†-æœ€æ–°ç‰ˆ.md) - åç«¯æœåŠ¡æ¶æ„
- [ç”¨æˆ·æ´»åŠ¨è®°å½•åŠŸèƒ½å®ç°æ€»ç»“.md](./ç”¨æˆ·æ´»åŠ¨è®°å½•åŠŸèƒ½å®ç°æ€»ç»“.md) - ç”¨æˆ·æ´»åŠ¨åŠŸèƒ½
- [æ–‡ä»¶å‘é‡åŒ–æµç¨‹.md](./æ–‡ä»¶å‘é‡åŒ–æµç¨‹.md) - æ–‡æ¡£å¤„ç†æµç¨‹

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—: `tail -f logs/app.log`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€: `curl http://localhost:8000/health`
3. éªŒè¯ç¯å¢ƒé…ç½®: æ£€æŸ¥ `.env.development` æ–‡ä»¶
4. é‡å¯æœåŠ¡: `./start_local.sh`

---

**æœ€åæ›´æ–°**: 2025-10-23  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**ç»´æŠ¤è€…**: ç³»ç»Ÿç®¡ç†å‘˜
