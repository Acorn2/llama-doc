# PDFæ–‡çŒ®æ™ºèƒ½åˆ†ææœåŠ¡ - å®Œæ•´æ¥å£æ–‡æ¡£ï¼ˆå‰ç«¯å¼€å‘ç‰ˆï¼‰

## æœåŠ¡æ¦‚è¿°

**æœåŠ¡åç§°**: åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„PDFæ–‡çŒ®æ™ºèƒ½åˆ†ææœåŠ¡  
**æŠ€æœ¯æ ˆ**: FastAPI + LangChain + Qdrant + PostgreSQL + JWTè®¤è¯  
**ç‰ˆæœ¬**: 1.0.0  
**APIæ–‡æ¡£**: `/docs` (Swagger UI)  
**åŸºç¡€URL**: `http://localhost:8000`

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·ç³»ç»Ÿ (User Management) ğŸ†•
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€JWTè®¤è¯
- æ”¯æŒé‚®ç®±å’Œæ‰‹æœºå·ä¸¤ç§ç™»å½•æ–¹å¼
- ç”¨æˆ·æƒé™ç®¡ç†ï¼ˆæ™®é€šç”¨æˆ·/è¶…çº§ç”¨æˆ·ï¼‰
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†å’Œæ›´æ–°

### 2. æ–‡æ¡£ç®¡ç† (Document Management)
- æ”¯æŒPDFã€TXTã€DOCã€DOCXæ–‡ä»¶ä¸Šä¼ 
- æ–‡æ¡£è§£æä¸å‘é‡åŒ–å¤„ç†
- æ–‡æ¡£çŠ¶æ€è·Ÿè¸ªä¸è¿›åº¦ç›‘æ§
- é‡å¤æ–‡ä»¶æ£€æµ‹ï¼ˆåŸºäºMD5ï¼‰
- æ”¯æŒæœ¬åœ°å­˜å‚¨å’Œè…¾è®¯äº‘COSå­˜å‚¨
- **ç”¨æˆ·æ•°æ®éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡æ¡£

### 3. çŸ¥è¯†åº“ç®¡ç† (Knowledge Base Management) ğŸ†•
- ç§æœ‰çŸ¥è¯†åº“åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤
- **å…¬å¼€çŸ¥è¯†åº“åŠŸèƒ½**ï¼šç”¨æˆ·å¯å°†çŸ¥è¯†åº“è®¾ä¸ºå…¬å¼€ä¾›ä»–äººä½¿ç”¨
- çŸ¥è¯†åº“æ ‡ç­¾åˆ†ç±»å’Œæœç´¢
- çŸ¥è¯†åº“ç‚¹èµå’Œè®¿é—®ç»Ÿè®¡
- æ–‡æ¡£ä¸çŸ¥è¯†åº“å…³è”ç®¡ç†
- å‘é‡å­˜å‚¨é›†åˆç®¡ç†

### 4. æ™ºèƒ½å¯¹è¯ (Conversation Management)
- åŸºäºçŸ¥è¯†åº“çš„æ™ºèƒ½é—®ç­”
- å¯¹è¯å†å²ç®¡ç†ï¼ˆç”¨æˆ·ç§æœ‰ï¼‰
- æµå¼å¯¹è¯æ”¯æŒ
- ä¸Šä¸‹æ–‡è®°å¿†åŠŸèƒ½
- **æƒé™æ§åˆ¶**ï¼šç”¨æˆ·å¯è®¿é—®è‡ªå·±çš„çŸ¥è¯†åº“å’Œå…¬å¼€çŸ¥è¯†åº“

### 5. Agentæ™ºèƒ½ä½“ (Intelligent Agent)
- åŸºäºLangChainçš„æ™ºèƒ½Agent
- æ–‡æ¡£åˆ†æä¸æ‘˜è¦ç”Ÿæˆ
- çŸ¥è¯†æœç´¢ä¸æ¨ç†
- AgentçŠ¶æ€ç®¡ç†ä¸ç¼“å­˜

### 6. ç³»ç»Ÿç›‘æ§ (System Monitoring)
- å¥åº·æ£€æŸ¥ä¸çŠ¶æ€ç›‘æ§
- ç³»ç»Ÿèµ„æºç›‘æ§
- å¤„ç†ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

---

## è®¤è¯è¯´æ˜ ğŸ†•

### JWTè®¤è¯æœºåˆ¶
- å¤§éƒ¨åˆ†APIæ¥å£éœ€è¦JWTè®¤è¯
- è¯·æ±‚å¤´æ ¼å¼ï¼š`Authorization: Bearer <token>`
- Tokenæœ‰æ•ˆæœŸï¼š60åˆ†é’Ÿï¼ˆå¯é…ç½®ï¼‰
- æ”¯æŒTokenåˆ·æ–°

### å…è®¤è¯æ¥å£
- `GET /` - æ ¹è·¯å¾„
- `POST /api/v1/users/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/users/login` - ç”¨æˆ·ç™»å½•
- `GET /api/v1/knowledge-bases/public` - å…¬å¼€çŸ¥è¯†åº“åˆ—è¡¨
- `GET /health/*` - å¥åº·æ£€æŸ¥

---

## APIæ¥å£è¯¦ç»†è¯´æ˜

### 1. æ ¹è·¯å¾„æ¥å£

#### GET `/`
**åŠŸèƒ½**: è·å–APIåŸºæœ¬ä¿¡æ¯  
**è®¤è¯**: æ— éœ€è®¤è¯  
**è¯·æ±‚å‚æ•°**: æ—   
**å“åº”ç¤ºä¾‹**:
```json
{
  "message": "æ¬¢è¿ä½¿ç”¨ PDFæ–‡çŒ®åˆ†ææ™ºèƒ½ä½“",
  "version": "1.0.0",
  "description": "åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„PDFæ–‡çŒ®æ™ºèƒ½åˆ†ææœåŠ¡",
  "docs": "/docs",
  "health": "/health",
  "features": [
    "PDFæ–‡æ¡£ä¸Šä¼ ä¸è§£æ",
    "æ™ºèƒ½æ–‡æ¡£é—®ç­”",
    "çŸ¥è¯†åº“ç®¡ç†",
    "å…¬å¼€çŸ¥è¯†åº“åˆ†äº«",
    "Agentæ™ºèƒ½å¯¹è¯",
    "æ–‡æ¡£æ‘˜è¦ç”Ÿæˆ"
  ]
}
```

---

### 2. ç”¨æˆ·ç®¡ç†æ¥å£ (å‰ç¼€: `/api/v1/users`) ğŸ†•

#### POST `/api/v1/users/register`
**åŠŸèƒ½**: ç”¨æˆ·æ³¨å†Œ  
**è®¤è¯**: æ— éœ€è®¤è¯  
**è¯·æ±‚ä½“**:
```json
{
  "username": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "password": "password123",
  "full_name": "å¼ ä¸‰"
}
```
**å­—æ®µè¯´æ˜**:
- `username`: ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰
- `email`: é‚®ç®±åœ°å€ï¼ˆemailå’Œphoneè‡³å°‘å¡«ä¸€ä¸ªï¼‰
- `phone`: æ‰‹æœºå·ï¼ˆemailå’Œphoneè‡³å°‘å¡«ä¸€ä¸ªï¼‰
- `password`: å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
- `full_name`: å…¨åï¼ˆå¯é€‰ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "id": "user-uuid",
  "username": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "full_name": "å¼ ä¸‰",
  "avatar_url": null,
  "is_active": true,
  "is_superuser": false,
  "create_time": "2024-01-01T12:00:00",
  "update_time": null,
  "last_login_time": null
}
```

#### POST `/api/v1/users/login`
**åŠŸèƒ½**: ç”¨æˆ·ç™»å½•  
**è®¤è¯**: æ— éœ€è®¤è¯  
**è¯·æ±‚ä½“**:
```json
{
  "login_credential": "zhangsan@example.com",
  "password": "password123"
}
```
**å­—æ®µè¯´æ˜**:
- `login_credential`: ç™»å½•å‡­æ®ï¼ˆé‚®ç®±æˆ–æ‰‹æœºå·ï¼‰
- `password`: å¯†ç 

**å“åº”ç¤ºä¾‹**:
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": "user-uuid",
    "username": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "full_name": "å¼ ä¸‰",
    "avatar_url": null,
    "is_active": true,
    "is_superuser": false,
    "create_time": "2024-01-01T12:00:00",
    "last_login_time": "2024-01-01T12:30:00"
  }
}
```

#### GET `/api/v1/users/me`
**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯  
**è®¤è¯**: éœ€è¦JWT Token  
**å“åº”**: åŒæ³¨å†Œæ¥å£çš„ç”¨æˆ·ä¿¡æ¯

#### PUT `/api/v1/users/me`
**åŠŸèƒ½**: æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ä½“**:
```json
{
  "username": "æ–°ç”¨æˆ·å",
  "email": "newemail@example.com",
  "phone": "13900139000",
  "full_name": "æ–°å…¨å",
  "avatar_url": "http://example.com/avatar.jpg",
  "password": "newpassword123"
}
```
**æ³¨æ„**: æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„

#### POST `/api/v1/users/refresh`
**åŠŸèƒ½**: åˆ·æ–°è®¿é—®ä»¤ç‰Œ  
**è®¤è¯**: éœ€è¦JWT Token  
**å“åº”**: åŒç™»å½•æ¥å£

#### GET `/api/v1/users/activities` ğŸ†•
**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„æ´»åŠ¨è®°å½•  
**è®¤è¯**: éœ€è¦JWT Token  
**æŸ¥è¯¢å‚æ•°**:
- `limit`: è¿”å›è®°å½•æ•° (é»˜è®¤: 5, æœ€å¤§: 20)
- `activity_type`: æ´»åŠ¨ç±»å‹è¿‡æ»¤ (å¯é€‰)

**å“åº”ç¤ºä¾‹**:
```json
[
  {
    "id": "activity-uuid",
    "user_id": "user-uuid",
    "activity_type": "document_upload",
    "activity_description": "ä¸Šä¼ æ–‡æ¡£: example.pdf",
    "resource_type": "document",
    "resource_id": "doc-uuid",
    "activity_metadata": {
      "filename": "example.pdf",
      "file_size": 1024000,
      "file_type": "pdf"
    },
    "ip_address": "192.168.1.100",
    "user_agent": "Mozilla/5.0...",
    "create_time": "2024-01-01T12:00:00"
  }
]
```

#### GET `/api/v1/users/activities/stats` ğŸ†•
**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„æ´»åŠ¨ç»Ÿè®¡  
**è®¤è¯**: éœ€è¦JWT Token  
**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•° (é»˜è®¤: 30)

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "total_activities": 156,
    "activity_by_type": {
      "user_login": 12,
      "document_upload": 8,
      "kb_create": 3,
      "agent_chat": 89,
      "conversation_create": 15
    },
    "period_days": 30
  },
  "message": "è·å–æ´»åŠ¨ç»Ÿè®¡æˆåŠŸ"
}
```

#### GET `/api/v1/users/dashboard/stats` ğŸ†•
**åŠŸèƒ½**: è·å–ç”¨æˆ·ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®ï¼ˆæ”¯æŒå‰ç«¯ä»ªè¡¨æ¿æ˜¾ç¤ºï¼‰  
**è®¤è¯**: éœ€è¦JWT Token  
**æŸ¥è¯¢å‚æ•°**:
- `period`: ç»Ÿè®¡å‘¨æœŸ (é»˜è®¤: "30d", å¯é€‰: "7d", "30d", "90d")

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "document_stats": {
      "total": 1234,
      "growth_rate": 0.12,
      "growth_count": 132
    },
    "knowledge_base_stats": {
      "total": 56,
      "growth_rate": 0.08,
      "growth_count": 4
    },
    "conversation_stats": {
      "today": 89,
      "growth_rate": 0.15,
      "yesterday": 77
    },
    "activity_summary": {
      "total_activities": 2456,
      "most_active_type": "agent_chat",
      "recent_activities": [
        {
          "activity_type": "document_upload",
          "count": 12,
          "percentage": 15.2
        },
        {
          "activity_type": "agent_chat", 
          "count": 45,
          "percentage": 57.0
        }
      ]
    },
    "period": "30d",
    "last_updated": "2024-01-01T12:00:00"
  },
  "message": "è·å–ä»ªè¡¨æ¿ç»Ÿè®¡æˆåŠŸ"
}
```

#### GET `/api/v1/users/` (ä»…è¶…çº§ç”¨æˆ·)
**åŠŸèƒ½**: è·å–ç”¨æˆ·åˆ—è¡¨  
**è®¤è¯**: éœ€è¦è¶…çº§ç”¨æˆ·æƒé™  
**æŸ¥è¯¢å‚æ•°**:
- `skip`: è·³è¿‡è®°å½•æ•° (é»˜è®¤: 0)
- `limit`: è¿”å›è®°å½•æ•° (é»˜è®¤: 10)
- `is_active`: æ˜¯å¦æ´»è·ƒç”¨æˆ·è¿‡æ»¤ (å¯é€‰)

#### GET `/api/v1/users/{user_id}` (ä»…è¶…çº§ç”¨æˆ·æˆ–æœ¬äºº)
**åŠŸèƒ½**: è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯

#### PUT `/api/v1/users/{user_id}` (ä»…è¶…çº§ç”¨æˆ·)
**åŠŸèƒ½**: æ›´æ–°æŒ‡å®šç”¨æˆ·ä¿¡æ¯

#### DELETE `/api/v1/users/{user_id}` (ä»…è¶…çº§ç”¨æˆ·)
**åŠŸèƒ½**: ç¦ç”¨ç”¨æˆ·è´¦æˆ·

---

### 3. æ–‡æ¡£ç®¡ç†æ¥å£ (å‰ç¼€: `/api/v1/documents`)

#### POST `/api/v1/documents/upload`
**åŠŸèƒ½**: ä¸Šä¼ æ–‡æ¡£æ–‡ä»¶  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ç±»å‹**: `multipart/form-data`  
**è¯·æ±‚å‚æ•°**:
- `file`: æ–‡ä»¶å¯¹è±¡ (å¿…å¡«)

**æ”¯æŒçš„æ–‡ä»¶ç±»å‹**: PDF, TXT, DOC, DOCX  
**æ–‡ä»¶å¤§å°é™åˆ¶**: 50MB  

**å“åº”ç¤ºä¾‹**:
```json
{
  "document_id": "uuid-string",
  "filename": "example.pdf",
  "status": "pending",
  "upload_time": "2024-01-01T12:00:00",
  "file_type": "pdf",
  "message": "æ–‡æ¡£ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨ç­‰å¾…å¤„ç†..."
}
```

**æ³¨æ„**: æ–‡æ¡£ä¼šè‡ªåŠ¨å…³è”åˆ°å½“å‰ç™»å½•ç”¨æˆ·

#### GET `/api/v1/documents/{document_id}/status`
**åŠŸèƒ½**: è·å–æ–‡æ¡£å¤„ç†çŠ¶æ€  
**è®¤è¯**: éœ€è¦JWT Tokenï¼ˆä»…æ–‡æ¡£æ‰€æœ‰è€…å¯è®¿é—®ï¼‰  
**è·¯å¾„å‚æ•°**:
- `document_id`: æ–‡æ¡£ID (å¿…å¡«)

**å“åº”ç¤ºä¾‹**:
```json
{
  "document_id": "uuid-string",
  "status": "processing",
  "progress": 50,
  "message": "æ–‡æ¡£çŠ¶æ€: processing",
  "error_message": null
}
```

#### GET `/api/v1/documents/{document_id}`
**åŠŸèƒ½**: è·å–æ–‡æ¡£è¯¦ç»†ä¿¡æ¯  
**è®¤è¯**: éœ€è¦JWT Tokenï¼ˆä»…æ–‡æ¡£æ‰€æœ‰è€…å¯è®¿é—®ï¼‰

#### GET `/api/v1/documents`
**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„æ–‡æ¡£åˆ—è¡¨  
**è®¤è¯**: éœ€è¦JWT Token  
**æŸ¥è¯¢å‚æ•°**:
- `skip`: è·³è¿‡è®°å½•æ•° (é»˜è®¤: 0)
- `limit`: è¿”å›è®°å½•æ•° (é»˜è®¤: 20)

#### DELETE `/api/v1/documents/{document_id}`
**åŠŸèƒ½**: åˆ é™¤æ–‡æ¡£åŠå…¶ç›¸å…³èµ„æº  
**è®¤è¯**: éœ€è¦JWT Tokenï¼ˆä»…æ–‡æ¡£æ‰€æœ‰è€…å¯åˆ é™¤ï¼‰

#### POST `/api/v1/documents/check-duplicate`
**åŠŸèƒ½**: æ£€æŸ¥æ–‡æ¡£æ˜¯å¦é‡å¤  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ç±»å‹**: `multipart/form-data`

---

### 4. çŸ¥è¯†åº“ç®¡ç†æ¥å£ (å‰ç¼€: `/api/v1/knowledge-bases`) ğŸ†•

#### POST `/api/v1/knowledge-bases/`
**åŠŸèƒ½**: åˆ›å»ºçŸ¥è¯†åº“  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ä½“**:
```json
{
  "name": "æˆ‘çš„çŸ¥è¯†åº“",
  "description": "è¿™æ˜¯ä¸€ä¸ªç§æœ‰çŸ¥è¯†åº“",
  "is_public": false,
  "public_description": "å…¬å¼€æ—¶æ˜¾ç¤ºçš„æè¿°",
  "tags": ["æœºå™¨å­¦ä¹ ", "æ·±åº¦å­¦ä¹ ", "Python"]
}
```
**å­—æ®µè¯´æ˜**:
- `name`: çŸ¥è¯†åº“åç§°ï¼ˆå¿…å¡«ï¼‰
- `description`: ç§æœ‰æè¿°ï¼ˆå¯é€‰ï¼‰
- `is_public`: æ˜¯å¦å…¬å¼€ï¼ˆé»˜è®¤: falseï¼‰
- `public_description`: å…¬å¼€æè¿°ï¼ˆå¯é€‰ï¼Œå…¬å¼€æ—¶æ˜¾ç¤ºï¼‰
- `tags`: æ ‡ç­¾åˆ—è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºåˆ†ç±»å’Œæœç´¢ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "id": "kb-uuid",
  "user_id": "user-uuid",
  "name": "æˆ‘çš„çŸ¥è¯†åº“",
  "description": "è¿™æ˜¯ä¸€ä¸ªç§æœ‰çŸ¥è¯†åº“",
  "is_public": false,
  "public_description": "å…¬å¼€æ—¶æ˜¾ç¤ºçš„æè¿°",
  "tags": ["æœºå™¨å­¦ä¹ ", "æ·±åº¦å­¦ä¹ ", "Python"],
  "create_time": "2024-01-01T12:00:00",
  "update_time": null,
  "document_count": 0,
  "status": "active",
  "view_count": 0,
  "like_count": 0,
  "is_owner": true
}
```

#### GET `/api/v1/knowledge-bases/`
**åŠŸèƒ½**: è·å–ç”¨æˆ·å¯è®¿é—®çš„çŸ¥è¯†åº“åˆ—è¡¨  
**è®¤è¯**: éœ€è¦JWT Token  
**æŸ¥è¯¢å‚æ•°**:
- `include_public`: æ˜¯å¦åŒ…å«å…¬å¼€çŸ¥è¯†åº“ (é»˜è®¤: true)

**å“åº”**: çŸ¥è¯†åº“æ•°ç»„ï¼ˆåŒ…å«ç”¨æˆ·è‡ªå·±çš„ + å…¬å¼€çš„çŸ¥è¯†åº“ï¼‰

#### GET `/api/v1/knowledge-bases/public`
**åŠŸèƒ½**: è·å–å…¬å¼€çŸ¥è¯†åº“åˆ—è¡¨  
**è®¤è¯**: å¯é€‰ï¼ˆç™»å½•ç”¨æˆ·å¯çœ‹åˆ°ç‚¹èµçŠ¶æ€ï¼‰  
**æŸ¥è¯¢å‚æ•°**:
- `search`: æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰
- `tags`: æ ‡ç­¾è¿‡æ»¤ï¼ˆå¯é€‰ï¼Œå¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼‰
- `sort_by`: æ’åºå­—æ®µ (create_time, view_count, like_countï¼Œé»˜è®¤: create_time)
- `sort_order`: æ’åºé¡ºåº (asc, descï¼Œé»˜è®¤: desc)
- `page`: é¡µç  (é»˜è®¤: 1)
- `page_size`: æ¯é¡µæ•°é‡ (é»˜è®¤: 10, æœ€å¤§: 50)

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–å…¬å¼€çŸ¥è¯†åº“åˆ—è¡¨æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": "kb-uuid",
        "user_id": "owner-uuid",
        "name": "æœºå™¨å­¦ä¹ å…¥é—¨",
        "description": "ç§æœ‰æè¿°",
        "public_description": "é€‚åˆåˆå­¦è€…çš„æœºå™¨å­¦ä¹ çŸ¥è¯†åº“",
        "is_public": true,
        "tags": ["æœºå™¨å­¦ä¹ ", "æ·±åº¦å­¦ä¹ ", "Python"],
        "create_time": "2024-01-01T12:00:00",
        "document_count": 15,
        "view_count": 156,
        "like_count": 23,
        "owner_name": "å¼ è€å¸ˆ",
        "is_liked": false,
        "is_owner": false
      }
    ],
    "total": 25,
    "page": 1,
    "page_size": 10,
    "pages": 3
  }
}
```

#### PUT `/api/v1/knowledge-bases/{kb_id}`
**åŠŸèƒ½**: æ›´æ–°çŸ¥è¯†åº“ä¿¡æ¯  
**è®¤è¯**: éœ€è¦JWT Tokenï¼ˆä»…çŸ¥è¯†åº“åˆ›å»ºè€…å¯æ›´æ–°ï¼‰  
**è¯·æ±‚ä½“**:
```json
{
  "name": "æ–°åç§°",
  "description": "æ–°çš„ç§æœ‰æè¿°",
  "is_public": true,
  "public_description": "æ–°çš„å…¬å¼€æè¿°",
  "tags": ["æ–°æ ‡ç­¾1", "æ–°æ ‡ç­¾2"]
}
```
**æ³¨æ„**: æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„

#### POST `/api/v1/knowledge-bases/{kb_id}/like`
**åŠŸèƒ½**: åˆ‡æ¢çŸ¥è¯†åº“ç‚¹èµçŠ¶æ€  
**è®¤è¯**: éœ€è¦JWT Token  
**é™åˆ¶**: åªèƒ½å¯¹å…¬å¼€çŸ¥è¯†åº“ç‚¹èµ

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç‚¹èµæˆåŠŸ",
  "is_liked": true,
  "like_count": 24
}
```

#### POST `/api/v1/knowledge-bases/{kb_id}/access`
**åŠŸèƒ½**: è®°å½•çŸ¥è¯†åº“è®¿é—®è¡Œä¸º  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ä½“**:
```json
{
  "kb_id": "kb-uuid",
  "access_type": "view",
  "access_metadata": {
    "source": "search_result",
    "page": "knowledge_base_detail"
  }
}
```
**access_type**: viewï¼ˆæµè§ˆï¼‰, chatï¼ˆå¯¹è¯ï¼‰

#### POST `/api/v1/knowledge-bases/{kb_id}/documents/{document_id}`
**åŠŸèƒ½**: æ·»åŠ æ–‡æ¡£åˆ°çŸ¥è¯†åº“  
**è®¤è¯**: éœ€è¦JWT Token  
**æƒé™**: 
- çŸ¥è¯†åº“åˆ›å»ºè€…å¯ä»¥æ·»åŠ ä»»ä½•æ–‡æ¡£
- æ–‡æ¡£å¿…é¡»å±äºå½“å‰ç”¨æˆ·

#### DELETE `/api/v1/knowledge-bases/{kb_id}/documents/{document_id}`
**åŠŸèƒ½**: ä»çŸ¥è¯†åº“ç§»é™¤æ–‡æ¡£  
**è®¤è¯**: éœ€è¦JWT Tokenï¼ˆä»…çŸ¥è¯†åº“åˆ›å»ºè€…å¯æ“ä½œï¼‰

#### GET `/api/v1/knowledge-bases/{kb_id}/documents`
**åŠŸèƒ½**: åˆ—å‡ºçŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£  
**è®¤è¯**: éœ€è¦JWT Token  
**æƒé™**: çŸ¥è¯†åº“åˆ›å»ºè€…æˆ–å…¬å¼€çŸ¥è¯†åº“

#### POST `/api/v1/knowledge-bases/{kb_id}/search`
**åŠŸèƒ½**: æœç´¢çŸ¥è¯†åº“å†…å®¹  
**è®¤è¯**: éœ€è¦JWT Token  
**æƒé™**: çŸ¥è¯†åº“åˆ›å»ºè€…æˆ–å…¬å¼€çŸ¥è¯†åº“

---

### 5. å¯¹è¯ç®¡ç†æ¥å£ (å‰ç¼€: `/api/v1/conversations`)

#### POST `/api/v1/conversations/`
**åŠŸèƒ½**: åˆ›å»ºæ–°å¯¹è¯  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ä½“**:
```json
{
  "kb_id": "kb-uuid",
  "title": "å¯¹è¯æ ‡é¢˜"
}
```

**æƒé™æ£€æŸ¥**: 
- ç”¨æˆ·å¯ä»¥è®¿é—®è‡ªå·±çš„çŸ¥è¯†åº“
- ç”¨æˆ·å¯ä»¥è®¿é—®å…¬å¼€çš„çŸ¥è¯†åº“
- å¯¹è¯è®°å½•å§‹ç»ˆå±äºå½“å‰ç”¨æˆ·ï¼ˆç§æœ‰ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "id": "conv-uuid",
  "user_id": "user-uuid",
  "kb_id": "kb-uuid",
  "title": "å¯¹è¯æ ‡é¢˜",
  "create_time": "2024-01-01T12:00:00",
  "update_time": "2024-01-01T12:00:00",
  "status": "active"
}
```

#### GET `/api/v1/conversations/`
**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„å¯¹è¯åˆ—è¡¨  
**è®¤è¯**: éœ€è¦JWT Token  
**æŸ¥è¯¢å‚æ•°**:
- `kb_id`: çŸ¥è¯†åº“IDè¿‡æ»¤ (å¯é€‰)
- `skip`: è·³è¿‡è®°å½•æ•° (é»˜è®¤: 0)
- `limit`: è¿”å›è®°å½•æ•° (é»˜è®¤: 10)

#### POST `/api/v1/conversations/chat`
**åŠŸèƒ½**: èŠå¤©æ¥å£ï¼ˆåˆ›å»ºæˆ–ç»§ç»­å¯¹è¯ï¼‰  
**è®¤è¯**: éœ€è¦JWT Token  
**è¯·æ±‚ä½“**:
```json
{
  "conversation_id": "conv-uuid",
  "kb_id": "kb-uuid",
  "message": "ç”¨æˆ·æ¶ˆæ¯",
  "use_agent": false
}
```

**æƒé™æ£€æŸ¥**: 
- å¦‚æœä½¿ç”¨åˆ«äººçš„å…¬å¼€çŸ¥è¯†åº“ï¼Œä¼šè‡ªåŠ¨è®°å½•è®¿é—®è¡Œä¸º
- å¯¹è¯å†å²å§‹ç»ˆå±äºå½“å‰ç”¨æˆ·

#### POST `/api/v1/conversations/chat/stream`
**åŠŸèƒ½**: æµå¼èŠå¤©æ¥å£  
**è®¤è¯**: éœ€è¦JWT Token  
**å“åº”ç±»å‹**: `text/plain` (Server-Sent Events)

---

### 6. Agentæ™ºèƒ½ä½“æ¥å£ (å‰ç¼€: `/api/v1/agent`)

#### POST `/api/v1/agent/chat`
**åŠŸèƒ½**: Agentå¯¹è¯  
**è®¤è¯**: éœ€è¦JWT Token  
**æƒé™æ£€æŸ¥**: åŒå¯¹è¯æ¥å£

#### POST `/api/v1/agent/analyze`
**åŠŸèƒ½**: æ–‡æ¡£åˆ†æ  
**è®¤è¯**: éœ€è¦JWT Token

#### POST `/api/v1/agent/search`
**åŠŸèƒ½**: çŸ¥è¯†æœç´¢  
**è®¤è¯**: éœ€è¦JWT Token

#### POST `/api/v1/agent/summary`
**åŠŸèƒ½**: ç”Ÿæˆæ‘˜è¦  
**è®¤è¯**: éœ€è¦JWT Token

---

### 7. ç³»ç»Ÿä¿¡æ¯æ¥å£ (å‰ç¼€: `/api/v1/system`)

#### GET `/api/v1/system/health`
**åŠŸèƒ½**: å¥åº·æ£€æŸ¥  
**è®¤è¯**: æ— éœ€è®¤è¯

#### GET `/api/v1/system/models/info`
**åŠŸèƒ½**: è·å–æ¨¡å‹ä¿¡æ¯  
**è®¤è¯**: æ— éœ€è®¤è¯

---

## å‰ç«¯å¼€å‘å»ºè®® ğŸ†•

### 1. ç”¨æˆ·è®¤è¯æµç¨‹
```javascript
// 1. ç”¨æˆ·æ³¨å†Œ
const registerUser = async (userData) => {
  const response = await fetch('/api/v1/users/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(userData)
  });
  return response.json();
};

// 2. ç”¨æˆ·ç™»å½•
const loginUser = async (credentials) => {
  const response = await fetch('/api/v1/users/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(credentials)
  });
  const data = await response.json();
  
  // å­˜å‚¨token
  localStorage.setItem('access_token', data.access_token);
  localStorage.setItem('user_info', JSON.stringify(data.user));
  
  return data;
};

// 3. è·å–è®¤è¯å¤´
const getAuthHeaders = () => {
  const token = localStorage.getItem('access_token');
  return {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  };
};

// 4. æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
const isTokenValid = () => {
  const token = localStorage.getItem('access_token');
  if (!token) return false;
  
  try {
    const payload = JSON.parse(atob(token.split('.')[1]));
    return payload.exp * 1000 > Date.now();
  } catch {
    return false;
  }
};
```

### 2. çŸ¥è¯†åº“ç®¡ç†æµç¨‹
```javascript
// 1. åˆ›å»ºçŸ¥è¯†åº“
const createKnowledgeBase = async (kbData) => {
  const response = await fetch('/api/v1/knowledge-bases/', {
    method: 'POST',
    headers: getAuthHeaders(),
    body: JSON.stringify(kbData)
  });
  return response.json();
};

// 2. è·å–ç”¨æˆ·çŸ¥è¯†åº“åˆ—è¡¨
const getUserKnowledgeBases = async () => {
  const response = await fetch('/api/v1/knowledge-bases/', {
    headers: getAuthHeaders()
  });
  return response.json();
};

// 3. è·å–å…¬å¼€çŸ¥è¯†åº“åˆ—è¡¨
const getPublicKnowledgeBases = async (params = {}) => {
  const queryString = new URLSearchParams(params).toString();
  const response = await fetch(`/api/v1/knowledge-bases/public?${queryString}`, {
    headers: isTokenValid() ? getAuthHeaders() : {}
  });
  return response.json();
};

// 4. åˆ‡æ¢çŸ¥è¯†åº“å…¬å¼€çŠ¶æ€
const toggleKnowledgeBasePublic = async (kbId, isPublic) => {
  const response = await fetch(`/api/v1/knowledge-bases/${kbId}`, {
    method: 'PUT',
    headers: getAuthHeaders(),
    body: JSON.stringify({ is_public: isPublic })
  });
  return response.json();
};

// 5. ç‚¹èµçŸ¥è¯†åº“
const toggleLike = async (kbId) => {
  const response = await fetch(`/api/v1/knowledge-bases/${kbId}/like`, {
    method: 'POST',
    headers: getAuthHeaders()
  });
  return response.json();
};
```

### 3. é¡µé¢ç»“æ„å»ºè®®

#### 3.1 ç”¨æˆ·ç›¸å…³é¡µé¢
- `/login` - ç™»å½•é¡µé¢
- `/register` - æ³¨å†Œé¡µé¢
- `/profile` - ç”¨æˆ·èµ„æ–™é¡µé¢
- `/settings` - ç”¨æˆ·è®¾ç½®é¡µé¢

#### 3.2 çŸ¥è¯†åº“ç›¸å…³é¡µé¢
- `/knowledge-bases` - æˆ‘çš„çŸ¥è¯†åº“åˆ—è¡¨
- `/knowledge-bases/create` - åˆ›å»ºçŸ¥è¯†åº“
- `/knowledge-bases/:id/edit` - ç¼–è¾‘çŸ¥è¯†åº“
- `/knowledge-bases/public` - å…¬å¼€çŸ¥è¯†åº“å¹¿åœº
- `/knowledge-bases/:id/detail` - çŸ¥è¯†åº“è¯¦æƒ…é¡µ

#### 3.3 çŠ¶æ€ç®¡ç†å»ºè®®
```javascript
// ä½¿ç”¨Vue/Reactçš„çŠ¶æ€ç®¡ç†
const userStore = {
  user: null,
  token: null,
  isAuthenticated: false,
  
  // actions
  login(credentials) { /* ... */ },
  logout() { 
    localStorage.removeItem('access_token');
    localStorage.removeItem('user_info');
    this.user = null;
    this.token = null;
    this.isAuthenticated = false;
  },
  checkAuth() { /* ... */ }
};
```

### 4. UIç»„ä»¶å»ºè®®

#### 4.1 ç”¨æˆ·è®¤è¯ç»„ä»¶
- `LoginForm` - ç™»å½•è¡¨å•ï¼ˆæ”¯æŒé‚®ç®±/æ‰‹æœºå·ï¼‰
- `RegisterForm` - æ³¨å†Œè¡¨å•
- `UserAvatar` - ç”¨æˆ·å¤´åƒç»„ä»¶
- `AuthGuard` - è·¯ç”±å®ˆå«ç»„ä»¶

#### 4.2 çŸ¥è¯†åº“ç»„ä»¶
- `KnowledgeBaseCard` - çŸ¥è¯†åº“å¡ç‰‡
- `PublicKnowledgeBaseGrid` - å…¬å¼€çŸ¥è¯†åº“ç½‘æ ¼
- `KnowledgeBaseForm` - çŸ¥è¯†åº“åˆ›å»º/ç¼–è¾‘è¡¨å•
- `LikeButton` - ç‚¹èµæŒ‰é’®
- `TagFilter` - æ ‡ç­¾è¿‡æ»¤å™¨
- `AccessCounter` - è®¿é—®ç»Ÿè®¡æ˜¾ç¤º

#### 4.3 æƒé™æ§åˆ¶ç»„ä»¶
```vue
<template>
  <div v-if="hasPermission">
    <slot />
  </div>
  <div v-else>
    <p>æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤å†…å®¹</p>
  </div>
</template>

<script>
export default {
  props: ['requiredPermission'],
  computed: {
    hasPermission() {
      // æ£€æŸ¥ç”¨æˆ·æƒé™é€»è¾‘
      return this.checkUserPermission(this.requiredPermission);
    }
  }
}
</script>
```

### 5. é”™è¯¯å¤„ç†å»ºè®®
```javascript
// ç»Ÿä¸€çš„APIé”™è¯¯å¤„ç†
const handleApiError = (error, response) => {
  if (response.status === 401) {
    // Tokenè¿‡æœŸï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
    userStore.logout();
    router.push('/login');
  } else if (response.status === 403) {
    // æƒé™ä¸è¶³
    showErrorMessage('æƒé™ä¸è¶³');
  } else if (response.status === 404) {
    // èµ„æºä¸å­˜åœ¨
    showErrorMessage('èµ„æºä¸å­˜åœ¨');
  } else {
    // å…¶ä»–é”™è¯¯
    showErrorMessage(error.detail || 'æ“ä½œå¤±è´¥');
  }
};
```

---

## æƒé™ä½“ç³»è¯´æ˜ ğŸ†•

### 1. ç”¨æˆ·è§’è‰²
- **æ™®é€šç”¨æˆ·**: å¯ä»¥ç®¡ç†è‡ªå·±çš„æ–‡æ¡£å’ŒçŸ¥è¯†åº“ï¼Œä½¿ç”¨å…¬å¼€çŸ¥è¯†åº“
- **è¶…çº§ç”¨æˆ·**: æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ä»¥ç®¡ç†æ‰€æœ‰ç”¨æˆ·å’Œèµ„æº

### 2. èµ„æºè®¿é—®æƒé™
- **æ–‡æ¡£**: ä»…åˆ›å»ºè€…å¯è®¿é—®å’Œç®¡ç†
- **çŸ¥è¯†åº“**: 
  - ç§æœ‰çŸ¥è¯†åº“ï¼šä»…åˆ›å»ºè€…å¯è®¿é—®å’Œç®¡ç†
  - å…¬å¼€çŸ¥è¯†åº“ï¼šæ‰€æœ‰ç”¨æˆ·å¯æŸ¥çœ‹å’Œä½¿ç”¨ï¼Œä»…åˆ›å»ºè€…å¯ç®¡ç†
- **å¯¹è¯**: ä»…ç”¨æˆ·è‡ªå·±çš„å¯¹è¯è®°å½•ï¼Œå³ä½¿ä½¿ç”¨å…¬å¼€çŸ¥è¯†åº“

### 3. æ“ä½œæƒé™çŸ©é˜µ

| æ“ä½œ | æ™®é€šç”¨æˆ· | è¶…çº§ç”¨æˆ· | å¤‡æ³¨ |
|------|----------|----------|------|
| æ³¨å†Œç™»å½• | âœ… | âœ… | æ‰€æœ‰äººå¯ç”¨ |
| ä¸Šä¼ æ–‡æ¡£ | âœ… | âœ… | ä»…èƒ½ç®¡ç†è‡ªå·±çš„æ–‡æ¡£ |
| åˆ›å»ºçŸ¥è¯†åº“ | âœ… | âœ… | - |
| è®¾ç½®çŸ¥è¯†åº“å…¬å¼€ | âœ… | âœ… | ä»…è‡ªå·±çš„çŸ¥è¯†åº“ |
| ä½¿ç”¨å…¬å¼€çŸ¥è¯†åº“ | âœ… | âœ… | æ‰€æœ‰äººå¯ç”¨ |
| ç®¡ç†ç”¨æˆ· | âŒ | âœ… | ä»…è¶…çº§ç”¨æˆ· |

---

## ç”¨æˆ·æ´»åŠ¨è®°å½•è¯´æ˜ ğŸ†•

### æ´»åŠ¨ç±»å‹
ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•ç”¨æˆ·çš„å„ç§æ“ä½œè¡Œä¸ºï¼Œæ”¯æŒçš„æ´»åŠ¨ç±»å‹åŒ…æ‹¬ï¼š

#### ç”¨æˆ·è®¤è¯ç›¸å…³
- `user_login`: ç”¨æˆ·ç™»å½•
- `user_logout`: ç”¨æˆ·ç™»å‡º
- `user_register`: ç”¨æˆ·æ³¨å†Œ

#### æ–‡æ¡£ç›¸å…³
- `document_upload`: æ–‡æ¡£ä¸Šä¼ 
- `document_delete`: æ–‡æ¡£åˆ é™¤
- `document_view`: æ–‡æ¡£æŸ¥çœ‹
- `document_download`: æ–‡æ¡£ä¸‹è½½

#### çŸ¥è¯†åº“ç›¸å…³
- `kb_create`: åˆ›å»ºçŸ¥è¯†åº“
- `kb_update`: æ›´æ–°çŸ¥è¯†åº“
- `kb_delete`: åˆ é™¤çŸ¥è¯†åº“
- `kb_view`: æŸ¥çœ‹çŸ¥è¯†åº“
- `kb_like`: ç‚¹èµçŸ¥è¯†åº“
- `kb_unlike`: å–æ¶ˆç‚¹èµ
- `kb_share`: åˆ†äº«çŸ¥è¯†åº“

#### å¯¹è¯ç›¸å…³
- `conversation_create`: åˆ›å»ºå¯¹è¯
- `conversation_chat`: è¿›è¡Œå¯¹è¯
- `conversation_delete`: åˆ é™¤å¯¹è¯

#### Agentç›¸å…³
- `agent_chat`: Agentå¯¹è¯
- `agent_analyze`: Agentåˆ†æ
- `agent_search`: Agentæœç´¢
- `agent_summary`: Agentæ‘˜è¦ç”Ÿæˆ

#### ç³»ç»Ÿç›¸å…³
- `system_access`: ç³»ç»Ÿè®¿é—®

### æ´»åŠ¨è®°å½•ç‰¹ç‚¹
- **è‡ªåŠ¨è®°å½•**: æ‰€æœ‰ç”¨æˆ·æ“ä½œéƒ½ä¼šè‡ªåŠ¨è®°å½•ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨
- **éšç§ä¿æŠ¤**: æ¯ä¸ªç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ´»åŠ¨è®°å½•
- **ä¸°å¯Œå…ƒæ•°æ®**: è®°å½•æ“ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€ã€ç”¨æˆ·ä»£ç†ç­‰
- **æ€§èƒ½ä¼˜åŒ–**: æ´»åŠ¨è®°å½•å¤±è´¥ä¸ä¼šå½±å“ä¸»è¦ä¸šåŠ¡æµç¨‹
- **æ•°æ®æ¸…ç†**: æ”¯æŒå®šæœŸæ¸…ç†è¿‡æœŸçš„æ´»åŠ¨è®°å½•

## æ•°æ®æ¨¡å‹è¯´æ˜ ğŸ†•

### ç”¨æˆ·æ¨¡å‹
```typescript
interface User {
  id: string;
  username?: string;
  email?: string;
  phone?: string;
  full_name?: string;
  avatar_url?: string;
  is_active: boolean;
  is_superuser: boolean;
  create_time: string;
  update_time?: string;
  last_login_time?: string;
}
```

### çŸ¥è¯†åº“æ¨¡å‹
```typescript
interface KnowledgeBase {
  id: string;
  user_id: string;
  name: string;
  description?: string;
  is_public: boolean;
  public_description?: string;
  tags: string[];
  create_time: string;
  update_time?: string;
  document_count: number;
  status: string;
  view_count: number;
  like_count: number;
  
  // æ‰©å±•å­—æ®µï¼ˆç‰¹å®šæ¥å£è¿”å›ï¼‰
  owner_name?: string;
  is_liked?: boolean;
  is_owner?: boolean;
}
```

### ç”¨æˆ·æ´»åŠ¨è®°å½•æ¨¡å‹ ğŸ†•
```typescript
interface UserActivity {
  id: string;
  user_id: string;
  activity_type: string;
  activity_description: string;
  resource_type?: string;
  resource_id?: string;
  activity_metadata?: Record<string, any>;
  ip_address?: string;
  user_agent?: string;
  create_time: string;
}
```

---

## ç¯å¢ƒé…ç½® ğŸ†•

### å¿…éœ€çš„ç¯å¢ƒå˜é‡
```bash
# JWT é…ç½®
JWT_SECRET_KEY=your-production-secret-key
ACCESS_TOKEN_EXPIRE_MINUTES=10080  # 7å¤© = 7 * 24 * 60 = 10080åˆ†é’Ÿ

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost/dbname
DB_TYPE=postgresql

# å…¶ä»–é…ç½®...
```

---

*æœ¬æ–‡æ¡£åŸºäºæœ€æ–°çš„ç”¨æˆ·ç³»ç»Ÿå’Œå…¬å¼€çŸ¥è¯†åº“åŠŸèƒ½æ›´æ–°ï¼Œå»ºè®®å‰ç«¯å¼€å‘å›¢é˜Ÿé‡ç‚¹å…³æ³¨è®¤è¯æµç¨‹å’Œæƒé™æ§åˆ¶çš„å®ç°ã€‚*